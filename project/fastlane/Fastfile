# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:android)

platform :android do
    OUTPUT_DIR = "jenkins_build"

    desc "Android Project Clean"
    lane :clean do
        gradle(task: "clean")
    end

    desc "Android-test 测试包"
    lane :fat do |options|
        parentOutputDir = OUTPUT_DIR
        versionCode=options[:code]
        moduleName=options[:moduleName]
        puts versionCode
        if [ ! $moduleName ]; then
            puts "moduleName is empty"
            moduleName = "app"
        end
        # outputDir = parentOutputDir + "/fat/" + versionCode
        # puts outputDir
        gradle(
            task: ":" + moduleName + ":assemble",
            build_type:"Release",
            flavor:"official",
            print_command: true,
            properties: {
                "versionCode" => versionCode,
                "baseUrlConfig" => "fat"
            }
        )
    end

    desc "Android-release 发布包"
    lane :pro do |options|
        parentOutputDir = OUTPUT_DIR
        versionCode=options[:code]
        baseUrl=options[:baseUrl]
        interactBaseUrl=options[:interactBaseUrl]
        gameBaseUrl=options[:gameBaseUrl]
        buglyAppId=options[:buglyAppId]
        gameIsTestEnv=options[:gameIsTestEnv]
        puts versionCode
        # outputDir = parentOutputDir + "/fat/" + versionCode
        # puts outputDir
        gradle(
            task: ":app:assemble",
            build_type:"Release",
            flavor:"official",
            print_command: true,
            properties: {
                "versionCode" => versionCode,
                "jksPropertyPath" => "../../../../../../../certs/hellosud/hellosud_jks_release.properties",
                "baseUrlConfig" => "pro",
                "baseUrl" => baseUrl,
                "interactBaseUrl" => interactBaseUrl,
                "gameBaseUrl" => gameBaseUrl,
                "buglyAppId" => buglyAppId,
                "gameIsTestEnv" => gameIsTestEnv
            }
        )
    end
end
